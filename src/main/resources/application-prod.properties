# Production Profile for Render Deployment
spring.application.name=urlshortener

# Server Configuration
# Render automatically sets the PORT environment variable
server.port=${PORT:8080}

# Database Configuration - Render provides DATABASE_URL in format:
# postgres://user:password@host:port/database
# We need to convert it to JDBC format
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/urlshortener}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection Pool Configuration (optimized for Render free tier - 512MB RAM)
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.open-in-view=false

# Logging Configuration (reduced for production)
logging.level.root=INFO
logging.level.com.adewunmi.urlshortener=INFO
logging.level.org.springframework.web=WARN
logging.level.org.springframework.cache=WARN
logging.level.org.springframework.data.redis=WARN
logging.level.org.hibernate.SQL=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} %-5level [%thread] %logger{36} - %msg%n

# Application Configuration
app.base-url=${BASE_URL:https://your-app.onrender.com}

# Redis Configuration - Disabled for Render free tier
# The app will automatically fall back to in-memory caching
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration
spring.cache.type=none

# Rate Limiting - Use in-memory instead of Redis (suitable for single instance)
rate.limit.enabled=true
rate.limit.shorten.capacity=10
rate.limit.shorten.refill-tokens=10
rate.limit.shorten.refill-duration-minutes=60
rate.limit.redirect.capacity=100
rate.limit.redirect.refill-tokens=100
rate.limit.redirect.refill-duration-minutes=1

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized
management.health.redis.enabled=false
management.health.db.enabled=true

# Security Configuration
spring.security.user.name=${ADMIN_USERNAME:admin}
spring.security.user.password=${ADMIN_PASSWORD:changeme123}

# Error handling
server.error.include-message=always
server.error.include-stacktrace=on_param

# Render platform specific
server.forward-headers-strategy=native
server.tomcat.remoteip.remote-ip-header=x-forwarded-for
server.tomcat.remoteip.protocol-header=x-forwarded-proto